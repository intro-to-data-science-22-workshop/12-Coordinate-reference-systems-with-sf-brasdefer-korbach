---
title: "Coordinated Reference Systems with sf"
subtitle: "Workshop: I2DS Tools for Data Science - Exercises"
author: "Juan Brasdefer & Benedikt Korbach"
date: " November 21st 2022"
output: 
  html_document:
    toc: TRUE
    theme: lumen
    df_print: paged
    number_sections: FALSE
    highlight: tango
    toc_depth: 2
    toc_float: True

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(usethis)
library(devtools)
```

$~$

TEXTTEXTEXT


*** 

In this little exercise we would like you to 


* Bullet


---
# Theory

Refreshing you memory from the presentation...

<div align="center">
<img src="http://www.geo.hunter.cuny.edu/~jochen/gtech201/lectures/lec6concepts/Datums/Basics%20of%20datums_files/image001.gif" width=700>
</div>

### Setup

```{r}
library(sf)   # classes and functions for vector data
library(tidyverse)  
library(units)
```

```{r}
## build a temporary folder on disk
temp <- tempfile()
download.url <- "https://userpage.fu-berlin.de/soga/300/30100_data_sets/spatial/"
zipfile <- "germany_districts.zip"
## download the file
download.file(paste0(download.url,zipfile),temp, mode="wb")
## unzip the file(s)
unzip(temp)
## close file connection
unlink(temp)
```

```{r}
german_districts <- st_read("./germany_districts.shp")
```

### Inspecting sf objects

```{r}
class(german_districts)
```
The `german_districts` object is a data frame. Therefore, we can easily use tidyverse functionalities. 

```{r}
german_districts %>% 
  head
```

```{r}
plot(german_districts)
```

```{r}
german_districts %>%
   ggplot() +
   geom_sf(color="grey")
```


```{r}
german_districts_new_CRS <- st_transform(german_districts, 4087)

german_districts_new_CRS %>% 
  head
```

```{r}
german_districts_new_CRS %>%
   ggplot() +
   geom_sf(color="grey")
```
```{r}
plot(german_districts['area'])
```

```{r}
german_districts %>%
   ggplot() +
   geom_sf(color="grey") +
   geom_sf(aes(fill = area))
```
```{r}
german_districts <- german_districts %>%
  mutate(area = set_units(st_area(german_districts), km^2))
```

```{r}
german_districts <- german_districts %>%
  mutate(density = as.double(pop/area))

german_districts
```


```{r}
german_districts %>%
   ggplot() +
   geom_sf(color="grey") +
   geom_sf(aes(fill = density))
```



