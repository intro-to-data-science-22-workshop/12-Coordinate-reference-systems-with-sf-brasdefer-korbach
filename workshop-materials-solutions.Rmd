---
title: "Coordinated Reference Systems with sf"
subtitle: "Workshop: I2DS Tools for Data Science - Exercises"
author: "Juan Brasdefer & Benedikt Korbach"
date: " November 21st 2022"
output: 
  html_document:
    toc: TRUE
    theme: lumen
    df_print: paged
    number_sections: FALSE
    highlight: tango
    toc_depth: 2
    toc_float: True

---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(usethis)
library(devtools)
```

$~$

TEXTTEXTEXT


*** 

In this little exercise we would like you to 


* Bullet


---
# Theory

Refreshing you memory from the presentation...

<div align="center">
<img src="http://www.geo.hunter.cuny.edu/~jochen/gtech201/lectures/lec6concepts/Datums/Basics%20of%20datums_files/image001.gif" width=700>
</div>

### Setup and Data

First, we need to download all relevant packages and the data we are going to use throughout the exercise. The data set contains the *spatial data* of all German districts.

```{r}
library(sf) # package for simple features
library(tidyverse)  
library(units) # package to convert units
```

```{r}
# build a temporary folder on disk
temp <- tempfile()
download.url <- "https://userpage.fu-berlin.de/soga/300/30100_data_sets/spatial/"
zipfile <- "germany_districts.zip"
# download the file
download.file(paste0(download.url,zipfile),temp, mode="wb")
# unzip the file(s)
unzip(temp)
# close file connection
unlink(temp)
```

```{r}
german_districts <- st_read("./germany_districts.shp")
```

### Inspecting sf objects
Let's take a first look at our data set.

## Exercise (1) 
**Report the first five observations in our data set. What information does the output contain? What is the class of `german_districts` ?** 

```{r}
german_districts %>% 
  head(5)
```

```{r}
class(german_districts)
```
The `german_districts` object is a data frame. Therefore, we can easily use tidyverse methods to wrangle our data. Let's look at the first elements of the dataframe.



### Exercise 1()) 
**What information does the output contain? How is it structured?** 


```{r}
plot(german_districts)
```

```{r}
german_districts %>%
   ggplot() +
   geom_sf(color="grey")
```


```{r}
german_districts_new_CRS <- st_transform(german_districts, 4087)

german_districts_new_CRS %>% 
  head
```

```{r}
german_districts_new_CRS %>%
   ggplot() +
   geom_sf(color="grey")
```
```{r}
plot(german_districts['area'])
```

```{r}
german_districts %>%
   ggplot() +
   geom_sf(color="grey") +
   geom_sf(aes(fill = area))
```
```{r}
german_districts <- german_districts %>%
  mutate(area = set_units(st_area(german_districts), km^2))
```

```{r}
german_districts <- german_districts %>%
  mutate(density = as.double(pop/area))

german_districts
```


```{r}
german_districts %>%
   ggplot() +
   geom_sf(color="grey") +
   geom_sf(aes(fill = density))
```



